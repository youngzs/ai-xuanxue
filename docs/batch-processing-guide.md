# 64å¦æ•°æ®åº“æ‰¹é‡å¤„ç†æŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨æ‰¹é‡å¤„ç†ç³»ç»Ÿæ„å»ºå®Œæ•´çš„64å¦æ•°æ®åº“ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
npm install

# æ£€æŸ¥ç¯å¢ƒ
node --version  # éœ€è¦ Node.js >= 14.0.0
```

### 2. ä¸€é”®æ„å»ºå®Œæ•´æ•°æ®åº“

```bash
# æ‰§è¡Œå®Œæ•´çš„æ„å»ºæµç¨‹
npm run build-db
```

è¿™ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
- å¤‡ä»½ç°æœ‰æ•°æ®
- æ‰¹é‡æŠ“å–64å¦æ•°æ®
- éªŒè¯æ•°æ®å®Œæ•´æ€§
- åˆå¹¶æ‰€æœ‰æ•°æ®æº
- ç”Ÿæˆæœ€ç»ˆæ•°æ®åº“
- ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š

## ğŸ“‹ è¯¦ç»†å‘½ä»¤è¯´æ˜

### åŸºç¡€å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `npm run build-db` | å®Œæ•´æ„å»ºæµç¨‹ | è‡ªåŠ¨åŒ–æ‰€æœ‰æ­¥éª¤ |
| `npm run extract-only` | ä»…æŠ“å–æ•°æ® | ä»ç½‘ç«™è·å–åŸå§‹æ•°æ® |
| `npm run merge-data` | ä»…åˆå¹¶æ•°æ® | åˆå¹¶å·²æœ‰çš„æ•°æ®æº |
| `npm run validate-data` | ä»…éªŒè¯æ•°æ® | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ |
| `npm run recover-data` | æ¢å¤è¿›åº¦ | ä»è¿›åº¦æ–‡ä»¶æ¢å¤ |
| `npm run cleanup` | æ¸…ç†ä¸´æ—¶æ–‡ä»¶ | åˆ é™¤ç¼“å­˜å’Œä¸´æ—¶æ•°æ® |

### é«˜çº§å‚æ•°

```bash
# è‡ªå®šä¹‰æŠ“å–èŒƒå›´
node scripts/batch-manager.js extract --start 1 --end 20

# è°ƒæ•´æ‰¹æ¬¡å¤§å°å’Œå»¶è¿Ÿ
node scripts/batch-manager.js build --batch 3 --delay 3000

# ä»æŒ‡å®šä½ç½®å¼€å§‹æ„å»º
node scripts/batch-manager.js build --start 25 --end 64
```

### å‚æ•°è¯´æ˜

- `--start N`: ä»ç¬¬Nå¦å¼€å§‹æŠ“å–ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `--end N`: æŠ“å–åˆ°ç¬¬Nå¦ç»“æŸï¼ˆé»˜è®¤ï¼š64ï¼‰
- `--batch N`: æ¯æ‰¹å¤„ç†Nä¸ªå¦è±¡ï¼ˆé»˜è®¤ï¼š5ï¼‰
- `--delay N`: æ‰¹æ¬¡é—´å»¶è¿ŸNæ¯«ç§’ï¼ˆé»˜è®¤ï¼š2000ï¼‰

## ğŸ”§ å·¥ä½œæµç¨‹è¯¦è§£

### 1. æ•°æ®æŠ“å–é˜¶æ®µ

```bash
npm run extract-only
```

**æ‰§è¡Œå†…å®¹ï¼š**
- ä»æ˜“å®‰å±…ç½‘ç«™æ‰¹é‡æŠ“å–64å¦è¯¦ç»†ä¿¡æ¯
- è‡ªåŠ¨å¤„ç†ç½‘ç»œé”™è¯¯å’Œé‡è¯•
- ä¿å­˜è¿›åº¦æ–‡ä»¶é˜²æ­¢ä¸­æ–­ä¸¢å¤±
- ç”Ÿæˆå¤‡ç”¨æ•°æ®å¡«è¡¥æŠ“å–å¤±è´¥çš„å¦è±¡

**è¾“å‡ºæ–‡ä»¶ï¼š**
- `source/js/extracted-hexagram-database.js` - æŠ“å–çš„æ•°æ®
- `source/js/progress/batch_*.json` - è¿›åº¦æ–‡ä»¶
- `scripts/extraction-report.md` - æŠ“å–æŠ¥å‘Š

### 2. æ•°æ®éªŒè¯é˜¶æ®µ

```bash
npm run validate-data
```

**éªŒè¯é¡¹ç›®ï¼š**
- 64å¦æ¨¡å¼å®Œæ•´æ€§æ£€æŸ¥
- æ•°æ®å­—æ®µå®Œæ•´æ€§ç»Ÿè®¡
- é‡å¤æ•°æ®æ£€æµ‹
- é”™è¯¯æ•°æ®è¯†åˆ«

### 3. æ•°æ®åˆå¹¶é˜¶æ®µ

```bash
npm run merge-data
```

**åˆå¹¶ç­–ç•¥ï¼š**
1. ä¼˜å…ˆçº§ï¼šæŠ“å–æ•°æ® > è¡¥å……æ•°æ® > ä¸»æ•°æ®åº“
2. å­—æ®µçº§åˆå¹¶ï¼šéç©ºã€é"å¾…è¡¥å……"çš„å€¼ä¼˜å…ˆ
3. å®Œæ•´æ€§æ£€æŸ¥ï¼šç¡®ä¿æ‰€æœ‰64å¦éƒ½æœ‰åŸºç¡€ä¿¡æ¯

### 4. æœ€ç»ˆç”Ÿæˆé˜¶æ®µ

**ç”Ÿæˆæ–‡ä»¶ï¼š**
- `source/js/merged-hexagram-database.js` - æœ€ç»ˆæ•°æ®åº“
- `scripts/batch-report.md` - ç»¼åˆæŠ¥å‘Š
- `backup/[timestamp]/` - å¤‡ä»½æ–‡ä»¶

## ğŸ“Š æ•°æ®è´¨é‡æ§åˆ¶

### è‡ªåŠ¨éªŒè¯æœºåˆ¶

1. **å®Œæ•´æ€§æ£€æŸ¥**
   - ç¡®ä¿64å¦æ¨¡å¼å…¨è¦†ç›–
   - éªŒè¯å¿…éœ€å­—æ®µï¼ˆç¼–å·ã€åç§°ã€å¦è¾ç­‰ï¼‰
   - æ£€æŸ¥æ•°æ®æ ¼å¼æ­£ç¡®æ€§

2. **è´¨é‡åˆ†çº§**
   - ğŸŸ¢ å®Œæ•´ï¼šæ‰€æœ‰ä¸»è¦å­—æ®µé½å…¨
   - ğŸŸ¡ éƒ¨åˆ†ï¼šè¶…è¿‡ä¸€åŠå­—æ®µæœ‰æ•ˆ
   - ğŸ”´ åŸºç¡€ï¼šä»…æœ‰åŸºæœ¬ä¿¡æ¯

3. **é”™è¯¯å¤„ç†**
   - ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•
   - æŠ“å–å¤±è´¥ä½¿ç”¨å¤‡ç”¨æ•°æ®
   - æ•°æ®å†²çªæ—¶æ™ºèƒ½åˆå¹¶

### æ‰‹åŠ¨å®¡æ ¸å»ºè®®

```bash
# æŸ¥çœ‹æŠ“å–æŠ¥å‘Š
cat scripts/extraction-report.md

# æŸ¥çœ‹ç»¼åˆæŠ¥å‘Š
cat scripts/batch-report.md

# æ£€æŸ¥ç‰¹å®šå¦è±¡
node -e "
const { getHexagram } = require('./source/js/merged-hexagram-database.js');
console.log(getHexagram('111111')); // ä¹¾å¦
"
```

## ğŸ”„ æ•…éšœæ¢å¤

### æŠ“å–ä¸­æ–­æ¢å¤

å¦‚æœæŠ“å–è¿‡ç¨‹ä¸­æ–­ï¼Œå¯ä»¥ä»è¿›åº¦æ–‡ä»¶æ¢å¤ï¼š

```bash
# æ¢å¤åˆ°æœ€æ–°è¿›åº¦
npm run recover-data

# ç»§ç»­ä»ä¸­æ–­ç‚¹æŠ“å–
node scripts/batch-manager.js extract --start 30
```

### æ•°æ®å¤‡ä»½æ¢å¤

```bash
# æŸ¥çœ‹å¤‡ä»½
ls backup/

# æ¢å¤ç‰¹å®šå¤‡ä»½
cp backup/2024-01-01T10-00-00-000Z/* source/js/
```

### æ¸…ç†å’Œé‡æ–°å¼€å§‹

```bash
# æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
npm run cleanup

# åˆ é™¤å·²æŠ“å–çš„æ•°æ®é‡æ–°å¼€å§‹
rm source/js/extracted-hexagram-database.js
rm source/js/merged-hexagram-database.js

# é‡æ–°æ‰§è¡Œå®Œæ•´æµç¨‹
npm run build-db
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æŠ“å–ä¼˜åŒ–

```bash
# å¢åŠ å¹¶å‘ï¼ˆå°å¿ƒè¢«é™åˆ¶ï¼‰
node scripts/batch-manager.js build --batch 10 --delay 1000

# å‡å°‘å¹¶å‘ï¼ˆç½‘ç»œä¸ç¨³å®šæ—¶ï¼‰
node scripts/batch-manager.js build --batch 2 --delay 5000
```

### ç½‘ç»œä¼˜åŒ–

- ä½¿ç”¨ç¨³å®šçš„ç½‘ç»œè¿æ¥
- é¿å…é«˜å³°æ—¶æ®µæŠ“å–
- é€‚å½“å¢åŠ å»¶è¿Ÿé¿å…è¢«é™åˆ¶

### èµ„æºä¼˜åŒ–

- å®šæœŸæ¸…ç†è¿›åº¦æ–‡ä»¶
- å‹ç¼©å¤‡ä»½æ–‡ä»¶èŠ‚çœç©ºé—´
- ç›‘æ§æŠ“å–è¿›ç¨‹å†…å­˜ä½¿ç”¨

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç½‘ç»œè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   ping www.zhouyi.cc
   
   # å¢åŠ å»¶è¿Ÿé‡è¯•
   node scripts/batch-manager.js extract --delay 5000
   ```

2. **æ•°æ®è§£æé”™è¯¯**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
   node scripts/extract-hexagram-data.js 2>&1 | tee extract.log
   ```

3. **æ–‡ä»¶æƒé™é—®é¢˜**
   ```bash
   # æ£€æŸ¥ç›®å½•æƒé™
   ls -la source/js/
   
   # ä¿®å¤æƒé™
   chmod 755 source/js/
   ```

4. **å†…å­˜ä¸è¶³**
   ```bash
   # å¢åŠ Node.jså†…å­˜é™åˆ¶
   node --max-old-space-size=4096 scripts/batch-manager.js build
   ```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•è¾“å‡º
DEBUG=* node scripts/batch-manager.js build

# å•ä¸ªå¦è±¡æµ‹è¯•
node -e "
const { extractHexagramDetails } = require('./scripts/extract-hexagram-data.js');
extractHexagramDetails(1, 'http://www.zhouyi.cc/zhouyi/yijing64/4071.html')
  .then(console.log);
"
```

## ğŸ“ˆ æ•°æ®åº“ç»´æŠ¤

### å®šæœŸæ›´æ–°

```bash
# æ¯æœˆæ›´æ–°ä¸€æ¬¡
npm run build-db

# éªŒè¯æ•°æ®è´¨é‡
npm run validate-data
```

### æ‰‹åŠ¨è¡¥å……

å¯¹äºæŠ“å–å¤±è´¥æˆ–æ•°æ®ä¸å‡†ç¡®çš„å¦è±¡ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ï¼š

```javascript
// ç¼–è¾‘ source/js/hexagram-database.js
'111111': {
    number: 1,
    name: 'ä¹¾',
    // ... è¡¥å……æˆ–ä¿®æ­£æ•°æ®
}
```

### ç‰ˆæœ¬æ§åˆ¶

```bash
# æäº¤å˜æ›´
git add source/js/merged-hexagram-database.js
git commit -m "æ›´æ–°64å¦æ•°æ®åº“"

# åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag -a v1.0.0 -m "å®Œæ•´64å¦æ•°æ®åº“ v1.0.0"
```

## ğŸ“‹ æ•°æ®æ ¼å¼è¯´æ˜

### å¦è±¡æ•°æ®ç»“æ„

```javascript
{
    "111111": {                    // äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆ6ä½ï¼‰
        "number": 1,               // å¦è±¡ç¼–å·
        "name": "ä¹¾",              // å¦å
        "description": "ä¹¾ä¸ºå¤©",   // æè¿°
        "trigrams": "ä¹¾ä¸Šä¹¾ä¸‹",    // å…«å¦ç»„åˆ
        "nature": "åˆšå¥ä¸­æ­£",      // æ€§è´¨
        "oracle": "ä¹¾ã€‚å…ƒï¼Œäº¨ï¼Œåˆ©ï¼Œè´ã€‚",  // å¦è¾
        "oracleMeaning": "...",    // å¦è¾é‡Šä¹‰
        "image": "å¤©è¡Œå¥...",      // è±¡è¾
        "imageMeaning": "...",     // è±¡è¾é‡Šä¹‰
        "judgment": "...",         // åˆ¤æ–­
        "business": "...",         // äº‹ä¸š
        "love": "...",            // æ„Ÿæƒ…
        "health": "...",          // å¥åº·
        "advice": "...",          // å»ºè®®
        "fortune": "...",         // è¿åŠ¿
        "images": {               // å›¾ç‰‡è·¯å¾„
            "main": "assets/hexagrams/01-qian.png",
            "structure": "assets/hexagrams/01-structure.png"
        }
    }
}
```

### ç»Ÿè®¡æ•°æ®ç»“æ„

```javascript
{
    "total": 64,                  // æ€»å¦è±¡æ•°
    "complete": 58,               // å®Œæ•´å¦è±¡æ•°
    "partial": 6,                 // éƒ¨åˆ†å®Œæ•´æ•°
    "minimal": 0,                 // åŸºç¡€æ•°æ®æ•°
    "completionRate": "94%",      // å®Œæ•´ç‡
    "fields": {                   // å­—æ®µç»Ÿè®¡
        "oracle": { "total": 64, "complete": 64 },
        "judgment": { "total": 64, "complete": 60 }
        // ...
    },
    "generatedAt": "2024-01-01T12:00:00.000Z"
}
```

## âœ… éªŒæ”¶æ ‡å‡†

å®Œæ•´çš„æ•°æ®åº“åº”è¾¾åˆ°ä»¥ä¸‹æ ‡å‡†ï¼š

1. **å®Œæ•´æ€§**: 64å¦å…¨è¦†ç›–ï¼Œæ— ç¼ºå¤±
2. **å‡†ç¡®æ€§**: æ•°æ®ä¸æƒå¨å…¸ç±ä¸€è‡´
3. **æ ¼å¼**: æ‰€æœ‰å­—æ®µæ ¼å¼æ­£ç¡®
4. **å®Œæ•´åº¦**: â‰¥90% çš„å¦è±¡æœ‰å®Œæ•´ä¿¡æ¯
5. **å¯ç”¨æ€§**: é€šè¿‡æ‰€æœ‰éªŒè¯æµ‹è¯•

### æœ€ç»ˆéªŒæ”¶å‘½ä»¤

```bash
# å®Œæ•´æ„å»º
npm run build-db

# éªŒè¯ç»“æœ
npm run validate-data

# æ£€æŸ¥æŠ¥å‘Š
cat scripts/batch-report.md
```

---

*é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥æ„å»ºå‡ºä¸“ä¸šçº§åˆ«çš„64å¦æ•°æ®åº“ï¼Œä¸ºå åœåº”ç”¨æä¾›å®Œæ•´å¯é çš„æ•°æ®æ”¯æŒã€‚* 